name: Sync Release APKs
 
on:
  schedule:
    - cron: "0 16 * * *"  # 每天午夜执行 
  workflow_dispatch:     # 支持手动触发
 
jobs:
  sync-apks:
    runs-on: ubuntu-latest
    steps:
      - name: 初始化工作目录
        run: |
          mkdir -p app/akjack app/fongmi
          echo "创建目标目录完成"
 
      - name: 配置Git全局设置 
        run: |
          git config --global user.name  "GitHub Actions"
          git config --global user.email  "actions@github.com" 
 
      # 拉取akjack分支内容 
      - name: 拉取FongMi/Release:okjack分支 
        working-directory: app/akjack 
        run: |
          git init
          git remote add origin https://github.com/FongMi/Release.git  
          git config core.sparsecheckout  true
          echo "okjack/apk/release/*" > .git/info/sparse-checkout 
          #git fetch --depth=1 origin okjack
          git fetch origin okjack 
          git checkout FETCH_HEAD -- okjack/apk/release 
          mv okjack/apk/release/* ./
          rm -rf okjack
 
      # 拉取fongmi分支内容
      - name: 拉取FongMi/Release:fongmi分支
        working-directory: app/fongmi
        run: |
          git init
          git remote add origin https://github.com/FongMi/Release.git  
          git config core.sparsecheckout  true
          echo "fongmi/apk/release/*" > .git/info/sparse-checkout
          #git fetch --depth=1 origin fongmi
          git fetch --depth=1 origin fongmi
          git checkout FETCH_HEAD -- fongmi/apk/release
          mv fongmi/apk/release/* ./
          rm -rf fongmi
 
      # 优化步骤 
      - name: 清理Git残留文件
        run: |
          find app -name ".git" -exec rm -rf {} \;
          find app -name ".gitignore" -delete 
 
      - name: 显示文件结构
        run: |
          echo "当前目录结构："
          find app -type f | sort
 
      - name: 存储缓存（可选）
        uses: actions/cache@v3 
        with:
          path: |
            app/akjack
            app/fongmi
          key: apk-cache-${{ github.run_id  }}
          retention-days: 3
